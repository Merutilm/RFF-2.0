cmake_minimum_required(VERSION 3.31)
project(RFF)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY  ${CMAKE_SOURCE_DIR}/bin)

add_compile_options(
        -O0
#        -Ofast
#        -march=native
#        -funroll-loops
)



add_executable(
        RFF
        res/resources.rc
        extern/glad.c
        extern/glad_wgl.c
        src/rff2/ui/Main.cpp
        src/rff2/opengl/GLShader.cpp
        src/rff2/opengl/GLRenderer.cpp
        src/rff2/opengl/GLRenderer.h
        src/rff2/calc/fp_complex_calculator.cpp
        src/rff2/calc/fp_complex_calculator.h
        src/rff2/ui/GLMainWindow.cpp
        src/rff2/ui/GLMainWindow.h
        src/rff2/constants/Constants.hpp
        src/rff2/settings/Settings.h
        src/rff2/settings/CalculationSettings.h
        src/rff2/settings/RenderSettings.h
        src/rff2/settings/ShaderSettings.h
        src/rff2/settings/SlopeSettings.h
        src/rff2/settings/StripeSettings.h
        src/rff2/settings/ColorSettings.h
        src/rff2/settings/PaletteSettings.h
        src/rff2/settings/FogSettings.h
        src/rff2/settings/VideoSettings.h
        src/rff2/settings/BloomSettings.h
        src/rff2/settings/DataSettings.h
        src/rff2/settings/ExportSettings.h
        src/rff2/settings/MpaSettings.h
        src/rff2/calc/fp_complex.cpp
        src/rff2/calc/fp_complex.h
        src/rff2/settings/DecimalizeIterationMethod.h
        src/rff2/settings/ReferenceCompressionSettings.h
        src/rff2/settings/ReuseReferenceMethod.h
        src/rff2/settings/Selectable.h
        src/rff2/calc/fp_decimal_calculator.cpp
        src/rff2/calc/fp_decimal_calculator.h
        src/rff2/calc/fp_decimal.cpp
        src/rff2/calc/fp_decimal.h
        src/rff2/ui/WGLContextLoader.cpp
        src/rff2/ui/WGLContextLoader.h
        src/rff2/ui/GLRenderScene.cpp
        src/rff2/ui/GLRenderScene.h
        src/rff2/formula/Perturbator.h
        src/rff2/ui/WGLScene.h
        src/rff2/ui/WGLScene.cpp
        src/rff2/io/RFFDynamicMapBinary.cpp
        src/rff2/io/RFFDynamicMapBinary.h
        src/rff2/data/Matrix.h
        src/rff2/opengl/GLRendererIteration.cpp
        src/rff2/opengl/GLRendererIteration.h
        src/rff2/settings/ColorSmoothingSettings.h
        src/rff2/data/ColorFloat.h
        src/rff2/settings/StripeType.h
        src/rff2/settings/AnimationSettings.h
        src/rff2/opengl/GLTimeRenderer.h
        src/rff2/opengl/GLTimeProvider.h
        src/rff2/formula/LightMandelbrotReference.cpp
        src/rff2/formula/LightMandelbrotReference.h
        src/rff2/parallel/ParallelRenderState.cpp
        src/rff2/parallel/ParallelRenderState.h
        src/rff2/calc/rff_math.h
        src/rff2/mrthy/ArrayCompressionTool.h
        src/rff2/mrthy/ArrayCompressor.h
        src/rff2/parallel/ParallelArrayDispatcher.h
        src/rff2/ui/Utilities.h
        src/rff2/formula/LightMandelbrotPerturbator.cpp
        src/rff2/formula/LightMandelbrotPerturbator.h
        src/rff2/mrthy/LightPA.h
        src/rff2/mrthy/LightMPATable.h
        src/rff2/mrthy/MPAPeriod.cpp
        src/rff2/mrthy/MPAPeriod.h
        src/rff2/ui/SettingsWindow.cpp
        src/rff2/ui/SettingsWindow.h
        src/rff2/ui/SettingsMenu.cpp
        src/rff2/ui/SettingsMenu.h
        src/rff2/ui/CallbackFile.cpp
        src/rff2/ui/CallbackFile.h
        src/rff2/ui/CallbackFractal.cpp
        src/rff2/ui/CallbackFractal.h
        src/rff2/ui/CallbackRender.cpp
        src/rff2/ui/CallbackRender.h
        src/rff2/opengl/GLMultipassRenderer.cpp
        src/rff2/opengl/GLMultipassRenderer.h
        src/rff2/opengl/GLRendererStripe.cpp
        src/rff2/opengl/GLRendererStripe.h
        src/rff2/opengl/GLRendererSlope.cpp
        src/rff2/opengl/GLRendererSlope.h
        src/rff2/opengl/GLRendererColor.cpp
        src/rff2/opengl/GLRendererColor.h
        src/rff2/opengl/GLRendererBoxBlur.cpp
        src/rff2/opengl/GLRendererBoxBlur.h
        src/rff2/opengl/GLRendererGaussianBlur.cpp
        src/rff2/opengl/GLRendererGaussianBlur.h
        src/rff2/opengl/GLRendererBloom.cpp
        src/rff2/opengl/GLRendererBloom.h
        src/rff2/opengl/GLRendererFog.cpp
        src/rff2/opengl/GLRendererFog.h
        src/rff2/opengl/GLRendererAntialiasing.cpp
        src/rff2/opengl/GLRendererAntialiasing.h
        src/rff2/ui/CallbackShader.cpp
        src/rff2/ui/CallbackShader.h
        src/rff2/locator/MandelbrotLocator.cpp
        src/rff2/locator/MandelbrotLocator.h
        src/rff2/ui/CallbackExplore.cpp
        src/rff2/ui/CallbackExplore.h
        src/rff2/calc/dex.h
        src/rff2/formula/DeepMandelbrotReference.cpp
        src/rff2/formula/DeepMandelbrotReference.h
        src/rff2/formula/MandelbrotReference.h
        src/rff2/calc/dex_std.h
        src/rff2/calc/double_exp_math.h
        src/rff2/formula/DeepMandelbrotPerturbator.cpp
        src/rff2/formula/DeepMandelbrotPerturbator.h
        src/rff2/formula/MandelbrotPerturbator.h
        src/rff2/mrthy/DeepPA.h
        src/rff2/mrthy/DeepMPATable.h
        src/rff2/mrthy/MPATable.h
        src/rff2/mrthy/PA.h
        src/rff2/ui/Callback.h
        src/rff2/mrthy/PAGenerator.h
        src/rff2/mrthy/LightPAGenerator.cpp
        src/rff2/mrthy/LightPAGenerator.h
        src/rff2/mrthy/DeepPAGenerator.cpp
        src/rff2/mrthy/DeepPAGenerator.h
        src/rff2/data/ApproxTableCache.h
        src/rff2/preset/shader/palette/PalettePresets.h
        src/rff2/preset/shader/color/ColorPresets.h
        src/rff2/preset/shader/bloom/BloomPresets.h
        src/rff2/preset/shader/fog/FogPresets.h
        src/rff2/preset/shader/slope/SlopePresets.h
        src/rff2/preset/shader/stripe/StripePresets.h
        src/rff2/preset/shader/palette/PalettePresets.cpp
        src/rff2/preset/shader/fog/FogPresets.cpp
        src/rff2/preset/shader/color/ColorPresets.cpp
        src/rff2/preset/shader/slope/SlopePresets.cpp
        src/rff2/preset/shader/stripe/StripePresets.cpp
        src/rff2/preset/shader/bloom/BloomPresets.cpp
        src/rff2/preset/Presets.h
        src/rff2/opengl/GLRendererDisplayer.cpp
        src/rff2/opengl/GLRendererDisplayer.h
        src/rff2/preset/resolution/ResolutionPresets.cpp
        src/rff2/preset/resolution/ResolutionPresets.h
        src/rff2/preset/render/RenderPresets.cpp
        src/rff2/preset/render/RenderPresets.h
        src/rff2/preset/calc/CalculationPresets.cpp
        src/rff2/preset/calc/CalculationPresets.h
        src/rff2/ui/CallbackVideo.cpp
        src/rff2/ui/CallbackVideo.h
        src/rff2/ui/IOUtilities.cpp
        src/rff2/ui/IOUtilities.h
        src/rff2/parallel/BackgroundThreads.h
        src/rff2/parallel/BackgroundThread.h
        src/rff2/ui/VideoWindow.cpp
        src/rff2/ui/VideoWindow.h
        src/rff2/ui/VideoRenderScene.cpp
        src/rff2/ui/VideoRenderScene.h
        src/rff2/opengl/GLRendererIteration2Map.cpp
        src/rff2/opengl/GLRendererIteration2Map.h
        src/rff2/opengl/GLShaderLoader.h
        src/rff2/opengl/GLShaderLoader.cpp
        src/rff2/opengl/GLShaderConfig.h
        src/rff2/opengl/GLShaderConfig.cpp
        src/rff2/io/RFFStaticMapBinary.cpp
        src/rff2/io/RFFStaticMapBinary.h
        src/rff2/io/RFFBinary.cpp
        src/rff2/io/RFFBinary.h
        src/rff2/opengl/GLRendererStatic2Image.cpp
        src/rff2/opengl/GLRendererStatic2Image.h
        src/rff2/io/RFFLocationBinary.cpp
        src/rff2/io/RFFLocationBinary.h
        src/rff2/opengl/GLRendererShdIteration2Map.h
        src/rff2/opengl/GLRendererColIteration2Map.cpp
        src/rff2/io/KFRColorLoader.cpp
        src/rff2/io/KFRColorLoader.hpp

        extern/stb_image.c
        extern/stb_image.h
        src/vulkan_helper/handle/Handler.hpp
        src/vulkan_helper/def/GraphicsContextWindow.cpp
        src/vulkan_helper/def/GraphicsContextWindow.hpp
        src/vulkan_helper/def/ValidationLayer.cpp
        src/vulkan_helper/def/ValidationLayer.hpp
        src/vulkan_helper/exception/exception.hpp
        src/vulkan_helper/def/Instance.cpp
        src/vulkan_helper/def/Instance.hpp
        src/vulkan_helper/def/Surface.cpp
        src/vulkan_helper/def/Surface.hpp
        src/vulkan_helper/def/PhysicalDevice.cpp
        src/vulkan_helper/def/PhysicalDevice.hpp
        src/vulkan_helper/struct/QueueFamilyIndices.hpp
        src/vulkan_helper/def/LogicalDevice.cpp
        src/vulkan_helper/def/LogicalDevice.hpp
        src/vulkan_helper/struct/StringHasher.hpp
        src/vulkan_helper/def/Swapchain.cpp
        src/vulkan_helper/def/Swapchain.hpp
        src/vulkan_helper/def/CommandPool.cpp
        src/vulkan_helper/def/CommandPool.hpp
        src/vulkan_helper/def/CommandBuffer.cpp
        src/vulkan_helper/def/CommandBuffer.hpp
        src/vulkan_helper/def/Descriptor.cpp
        src/vulkan_helper/def/Descriptor.hpp
        src/vulkan_helper/manage/ShaderObjectManager.hpp
        src/vulkan_helper/def/BufferObject.cpp
        src/vulkan_helper/def/BufferObject.hpp
        src/vulkan_helper/util/BufferImageUtils.hpp
        src/vulkan_helper/manage/DescriptorManager.hpp
        src/vulkan_helper/def/Pipeline.cpp
        src/vulkan_helper/def/Pipeline.hpp
        src/vulkan_helper/def/RenderPass.cpp
        src/vulkan_helper/def/RenderPass.hpp
        src/vulkan_helper/manage/PipelineManager.hpp
        src/vulkan_helper/def/DescriptorSetLayout.hpp
        src/vulkan_helper/struct/DescriptorSetLayoutBuildType.hpp
        src/vulkan_helper/def/PipelineLayout.hpp
        src/vulkan_helper/def/DescriptorSetLayout.cpp
        src/vulkan_helper/def/PipelineLayout.cpp
        src/vulkan_helper/manage/PushConstantManager.hpp
        src/vulkan_helper/def/ShaderModule.hpp
        src/vulkan_helper/def/ShaderModule.cpp
        src/vulkan_helper/manage/RenderPassManager.hpp
        src/vulkan_helper/struct/RenderPassAttachmentType.hpp
        src/vulkan_helper/def/Core.cpp
        src/vulkan_helper/def/Core.hpp
        src/vulkan_helper/handle/CoreHandler.hpp
        src/vulkan_helper/def/Framebuffer.cpp
        src/vulkan_helper/def/Framebuffer.hpp
        src/vulkan_helper/struct/RenderPassAttachment.hpp
        src/vulkan_helper/struct/ImageInitInfo.hpp
        src/vulkan_helper/def/SyncObject.cpp
        src/vulkan_helper/def/SyncObject.hpp
        src/vulkan_helper/executor/RenderPassExecutor.cpp
        src/vulkan_helper/executor/RenderPassExecutor.hpp
        src/vulkan_helper/struct/Vertex.hpp
        src/vulkan_helper/def/VertexBuffer.cpp
        src/vulkan_helper/def/VertexBuffer.hpp
        src/vulkan_helper/manage/CompleteShaderObjectManager.hpp
        src/vulkan_helper/def/Uniform.cpp
        src/vulkan_helper/def/Uniform.hpp
        src/vulkan_helper/executor/Executor.hpp
        src/vulkan_helper/repo/ShaderModuleRepo.hpp
        src/vulkan_helper/context/WindowContext.hpp
        src/vulkan_helper/context/RenderContext.hpp
        src/vulkan_helper/hash/VectorHasher.hpp
        src/vulkan_helper/hash/PointerDerefEquals.hpp
        src/vulkan_helper/repo/Repo.hpp
        src/vulkan_helper/repo/Repositories.hpp
        src/vulkan_helper/repo/IRepo.hpp
        src/vulkan_helper/manage/PipelineLayoutManager.hpp
        src/vulkan_helper/hash/BoostHasher.hpp
        src/vulkan_helper/repo/PipelineLayoutRepo.hpp
        src/vulkan_helper/def/IndexBuffer.cpp
        src/vulkan_helper/def/IndexBuffer.hpp
        src/vulkan_helper/def/Sampler2D.cpp
        src/vulkan_helper/def/Sampler2D.hpp
        src/vulkan_helper/configurator/GeneralPipelineConfigurator.cpp
        src/vulkan_helper/configurator/GeneralPipelineConfigurator.hpp
        src/vulkan_helper/repo/SharedDescriptorRepo.hpp
        src/vulkan_helper/struct/DescriptorTemplateInfo.hpp
        src/rff2/vulkan/SharedDescriptorTemplate.hpp
        src/vulkan_helper/def/Engine.cpp
        src/vulkan_helper/def/Engine.hpp
        src/rff2/vulkan/Template2PipelineConfigurator.cpp
        src/rff2/vulkan/Template2PipelineConfigurator.hpp
        src/vulkan_helper/executor/ScopedCommandExecutor.cpp
        src/vulkan_helper/executor/ScopedCommandExecutor.hpp
        src/vulkan_helper/struct/PushConstantReserve.hpp
        src/vulkan_helper/configurator/RenderContextConfigurator.hpp
        src/rff2/vulkan/BasicRenderContextConfigurator.hpp
        src/vulkan_helper/hash/DescriptorSetLayoutBuildTypeHasher.hpp
        src/vulkan_helper/context/ImageContext.hpp
        src/vulkan_helper/util/Presenter.hpp
        src/rff2/vulkan/Template1PipelineConfigurator.cpp
        src/rff2/vulkan/Template1PipelineConfigurator.hpp
        src/vulkan_helper/context/DescriptorUpdateContext.hpp
        src/vulkan_helper/util/IndexChecker.hpp
        src/vulkan_helper/util/ImageContextUtils.hpp
        src/vulkan_helper/configurator/GeneralPostProcessPipelineConfigurator.cpp
        src/vulkan_helper/configurator/GeneralPostProcessPipelineConfigurator.hpp
        src/rff2/ui/RenderScene.cpp
        src/rff2/ui/RenderScene.hpp
        src/rff2/ui/Application.cpp
        src/rff2/ui/Application.hpp
        src/rff2/constants/Win32Constants.hpp
        src/rff2/constants/RenderConstants.hpp
        src/rff2/constants/NumConstants.hpp
        src/rff2/constants/NullConstants.hpp
        src/rff2/constants/GraphicsConfigConstants.hpp
        src/rff2/constants/TextureFormatConstants.hpp
        src/rff2/constants/ExtensionConstants.hpp
        src/rff2/constants/StatusConstants.hpp
        src/vulkan_helper/configurator/PipelineConfigurator.hpp
        src/rff2/constants/VulkanWindowConstants.hpp
        src/vulkan_helper/struct/DescriptorTemplate.hpp
)


find_package(Vulkan REQUIRED)

target_compile_definitions(RFF
        PRIVATE
        VK_USE_PLATFORM_WIN32_KHR
)

target_include_directories(RFF PRIVATE
        # standard include
        ${CMAKE_SOURCE_DIR}/include
        # extern sources
        ${CMAKE_SOURCE_DIR}/extern
        # vulkan sdk directory
        ${Vulkan_INCLUDE_DIRS}
)

target_link_directories(RFF PRIVATE ${CMAKE_SOURCE_DIR}/lib)

target_link_libraries(RFF PRIVATE
        # OpenGL Linker
        opengl32
        # GMP Linker
        gmp
        # Win32 Linker
        comctl32
        # OpenCV Linkers
        opencv_core4110
        opencv_imgcodecs4110
        opencv_imgproc4110
        opencv_videoio4110
        opencv_highgui4110
        # Vulkan
        Vulkan::Vulkan
)


add_custom_target(spirv ALL COMMAND powershell -ExecutionPolicy Bypass -File "${CMAKE_CURRENT_SOURCE_DIR}/compile.ps1")
add_dependencies(RFF spirv)
